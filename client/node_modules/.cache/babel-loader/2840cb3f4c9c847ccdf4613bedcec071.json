{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nimport React, { useCallback, useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution } from 'stream-chat';\nimport { v4 as uuidv4 } from 'uuid';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator, LoadingIndicator as DefaultLoadingIndicator } from '../Loading';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { ChannelActionProvider } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport defaultEmojiData from '../../stream-emoji.json';\n\nvar UnMemoizedChannel = function (props) {\n  var propsChannel = props.channel,\n      _a = props.EmptyPlaceholder,\n      EmptyPlaceholder = _a === void 0 ? null : _a;\n  var contextChannel = useChatContext().channel;\n  var channel = propsChannel || contextChannel;\n  if (!(channel === null || channel === void 0 ? void 0 : channel.cid)) return EmptyPlaceholder;\n  return React.createElement(ChannelInner, __assign({}, props, {\n    channel: channel,\n    key: channel.cid\n  }));\n};\n\nvar ChannelInner = function (props) {\n  var acceptedFiles = props.acceptedFiles,\n      channel = props.channel,\n      children = props.children,\n      doMarkReadRequest = props.doMarkReadRequest,\n      doSendMessageRequest = props.doSendMessageRequest,\n      doUpdateMessageRequest = props.doUpdateMessageRequest,\n      _a = props.emojiData,\n      emojiData = _a === void 0 ? defaultEmojiData : _a,\n      _b = props.LoadingErrorIndicator,\n      LoadingErrorIndicator = _b === void 0 ? DefaultLoadingErrorIndicator : _b,\n      _c = props.LoadingIndicator,\n      LoadingIndicator = _c === void 0 ? DefaultLoadingIndicator : _c,\n      maxNumberOfFiles = props.maxNumberOfFiles,\n      _d = props.multipleUploads,\n      multipleUploads = _d === void 0 ? true : _d,\n      onMentionsClick = props.onMentionsClick,\n      onMentionsHover = props.onMentionsHover;\n\n  var _e = useChatContext(),\n      client = _e.client,\n      mutes = _e.mutes,\n      theme = _e.theme,\n      useImageFlagEmojisOnWindows = _e.useImageFlagEmojisOnWindows;\n\n  var t = useTranslationContext().t;\n\n  var _f = useState([]),\n      notifications = _f[0],\n      setNotifications = _f[1];\n\n  var _g = useState(),\n      quotedMessage = _g[0],\n      setQuotedMessage = _g[1];\n\n  var notificationTimeouts = [];\n\n  var _h = useReducer(channelReducer, initialState),\n      state = _h[0],\n      dispatch = _h[1];\n\n  var isMounted = useIsMounted();\n  var originalTitle = useRef('');\n  var lastRead = useRef(new Date());\n  var online = useRef(true);\n  var channelConfig = channel.getConfig();\n  var emojiConfig = {\n    commonEmoji: commonEmoji,\n    defaultMinimalEmojis: defaultMinimalEmojis,\n    emojiData: emojiData,\n    emojiSetDef: emojiSetDef\n  };\n  var throttledCopyStateFromChannel = useCallback(throttle(function () {\n    if (!channel) return;\n    dispatch({\n      channel: channel,\n      type: 'copyStateFromChannelOnEvent'\n    });\n  }, 500, {\n    leading: true,\n    trailing: true\n  }), [channel]);\n  var markRead = useCallback(function () {\n    var _a;\n\n    if (!channel || channel.disconnected || !((_a = channel.getConfig()) === null || _a === void 0 ? void 0 : _a.read_events)) {\n      return;\n    }\n\n    lastRead.current = new Date();\n\n    if (doMarkReadRequest) {\n      doMarkReadRequest(channel);\n    } else {\n      logChatPromiseExecution(channel.markRead(), 'mark read');\n    }\n\n    if (originalTitle.current) {\n      document.title = originalTitle.current;\n    }\n  }, [channel, doMarkReadRequest]);\n  var markReadThrottled = useCallback(throttle(markRead, 500, {\n    leading: true,\n    trailing: true\n  }), [markRead]);\n  var handleEvent = useCallback(function (event) {\n    var _a, _b, _c, _d, _e;\n\n    if (event.message) {\n      dispatch({\n        channel: channel,\n        message: event.message,\n        type: 'updateThreadOnEvent'\n      });\n    }\n\n    if (event.type === 'typing.start' || event.type === 'typing.stop') {\n      dispatch({\n        channel: channel,\n        type: 'setTyping'\n      });\n      return;\n    }\n\n    if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n      online.current = event.online;\n    }\n\n    if (event.type === 'message.new') {\n      var mainChannelUpdated = true;\n\n      if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n        mainChannelUpdated = false;\n      }\n\n      if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n        if (!document.hidden) {\n          markReadThrottled();\n        } else if (((_e = channel.getConfig()) === null || _e === void 0 ? void 0 : _e.read_events) && !channel.muteStatus().muted) {\n          var unread = channel.countUnread(lastRead.current);\n          document.title = \"(\" + unread + \") \" + originalTitle.current;\n        }\n      }\n    }\n\n    throttledCopyStateFromChannel();\n  }, [channel, client.userID, markReadThrottled, throttledCopyStateFromChannel]); // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n\n  useLayoutEffect(function () {\n    var errored = false;\n    var done = false;\n\n    var onVisibilityChange = function () {\n      if (!document.hidden) {\n        markRead();\n      }\n    };\n\n    (function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var e_1;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(channel && !channel.initialized)) return [3\n              /*break*/\n              , 4];\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , channel.watch()];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              e_1 = _a.sent();\n              dispatch({\n                error: e_1,\n                type: 'setError'\n              });\n              errored = true;\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              done = true;\n              originalTitle.current = document.title;\n\n              if (channel && !errored) {\n                dispatch({\n                  channel: channel,\n                  type: 'initStateFromChannel'\n                });\n                if (channel.countUnread() > 0) markRead(); // The more complex sync logic is done in Chat\n\n                document.addEventListener('visibilitychange', onVisibilityChange);\n                client.on('connection.changed', handleEvent);\n                client.on('connection.recovered', handleEvent);\n                client.on('user.updated', handleEvent);\n                client.on('user.deleted', handleEvent);\n                channel.on(handleEvent);\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    })();\n\n    return function () {\n      if (errored || !done) return;\n      document.removeEventListener('visibilitychange', onVisibilityChange);\n      if (channel) channel.off(handleEvent);\n      client.off('connection.changed', handleEvent);\n      client.off('connection.recovered', handleEvent);\n      client.off('user.updated', handleEvent);\n      client.off('user.deleted', handleEvent);\n      notificationTimeouts.forEach(clearTimeout);\n    };\n  }, [channel, client, handleEvent, markRead]);\n  useEffect(function () {\n    var _a;\n\n    if (state.thread && ((_a = state.messages) === null || _a === void 0 ? void 0 : _a.length)) {\n      for (var i = state.messages.length - 1; i >= 0; i -= 1) {\n        if (state.messages[i].id === state.thread.id) {\n          dispatch({\n            message: state.messages[i],\n            type: 'setThread'\n          });\n          break;\n        }\n      }\n    }\n  }, [state.messages, state.thread]);\n  /** MESSAGE */\n  // Adds a temporary notification to message list, will be removed after 5 seconds\n\n  var addNotification = function (text, type) {\n    if (typeof text !== 'string' || type !== 'success' && type !== 'error') {\n      return;\n    }\n\n    var id = uuidv4();\n    setNotifications(function (prevNotifications) {\n      return __spreadArray(__spreadArray([], prevNotifications), [{\n        id: id,\n        text: text,\n        type: type\n      }]);\n    });\n    var timeout = setTimeout(function () {\n      return setNotifications(function (prevNotifications) {\n        return prevNotifications.filter(function (notification) {\n          return notification.id !== id;\n        });\n      });\n    }, 5000);\n    notificationTimeouts.push(timeout);\n  };\n\n  var loadMoreFinished = useCallback(debounce(function (hasMore, messages) {\n    if (!isMounted.current) return;\n    dispatch({\n      hasMore: hasMore,\n      messages: messages,\n      type: 'loadMoreFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  }), []);\n  var loadMore = useCallback( // eslint-disable-next-line @typescript-eslint/no-inferrable-types\n  function (limit) {\n    if (limit === void 0) {\n      limit = 100;\n    }\n\n    return __awaiter(void 0, void 0, void 0, function () {\n      var oldestMessage, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!online.current || !window.navigator.onLine || !channel) return [2\n            /*return*/\n            , 0];\n            oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n            if (state.loadingMore || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received') return [2\n            /*return*/\n            , 0]; // initial state loads with up to 25 messages, so if less than 25 no need for additional query\n\n            if (channel.state.messages.length < 25) {\n              loadMoreFinished(false, channel.state.messages);\n              return [2\n              /*return*/\n              , channel.state.messages.length];\n            }\n\n            dispatch({\n              loadingMore: true,\n              type: 'setLoadingMore'\n            });\n            oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n            perPage = limit;\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , channel.query({\n              messages: {\n                id_lt: oldestID,\n                limit: perPage\n              },\n              watchers: {\n                limit: perPage\n              }\n            })];\n\n          case 2:\n            queryResponse = _b.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_2 = _b.sent();\n            console.warn('message pagination request failed with error', e_2);\n            dispatch({\n              loadingMore: false,\n              type: 'setLoadingMore'\n            });\n            return [2\n            /*return*/\n            , 0];\n\n          case 4:\n            hasMoreMessages = queryResponse.messages.length === perPage;\n            loadMoreFinished(hasMoreMessages, channel.state.messages);\n            return [2\n            /*return*/\n            , queryResponse.messages.length];\n        }\n      });\n    });\n  }, [channel, loadMoreFinished, online, state.loadingMore, state.messages]);\n  var updateMessage = useCallback(function (updatedMessage) {\n    if (!channel) return; // adds the message to the local channel state..\n    // this adds to both the main channel state as well as any reply threads\n\n    channel.state.addMessageSorted(updatedMessage, true);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && updatedMessage.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  }, [channel, state.thread]);\n\n  var isUserResponseArray = function (output) {\n    var _a;\n\n    return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null;\n  };\n\n  var doSendMessage = useCallback(function (message, customMessageData) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, error_1, stringError, parsedError;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!channel) return [2\n            /*return*/\n            ];\n            attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n            mentions = isUserResponseArray(mentioned_users) ? mentioned_users.map(function (_a) {\n              var id = _a.id;\n              return id;\n            }) : mentioned_users;\n            messageData = __assign({\n              attachments: attachments,\n              id: id,\n              mentioned_users: mentions,\n              parent_id: parent_id,\n              quoted_message_id: quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id,\n              text: text\n            }, customMessageData);\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 6,, 7]);\n\n            messageResponse = void 0;\n            if (!doSendMessageRequest) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , doSendMessageRequest(channel.cid, messageData)];\n\n          case 2:\n            messageResponse = _b.sent();\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            return [4\n            /*yield*/\n            , channel.sendMessage(messageData)];\n\n          case 4:\n            messageResponse = _b.sent();\n            _b.label = 5;\n\n          case 5:\n            // replace it after send is completed\n            if (messageResponse && messageResponse.message) {\n              updateMessage(__assign(__assign({}, messageResponse.message), {\n                status: 'received'\n              }));\n            }\n\n            if (quotedMessage) setQuotedMessage(undefined);\n            return [3\n            /*break*/\n            , 7];\n\n          case 6:\n            error_1 = _b.sent();\n            stringError = JSON.stringify(error_1);\n            parsedError = stringError ? JSON.parse(stringError) : {};\n            updateMessage(__assign(__assign({}, message), {\n              errorStatusCode: parsedError.status || undefined,\n              status: 'failed'\n            }));\n            return [3\n            /*break*/\n            , 7];\n\n          case 7:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [channel, doSendMessageRequest, quotedMessage, updateMessage]);\n  var createMessagePreview = useCallback(function (text, attachments, parent, mentioned_users) {\n    // create a preview of the message\n    var clientSideID = client.userID + \"-\" + uuidv4();\n    return __assign({\n      __html: text,\n      attachments: attachments,\n      created_at: new Date(),\n      html: text,\n      id: clientSideID,\n      mentioned_users: mentioned_users,\n      reactions: [],\n      status: 'sending',\n      text: text,\n      type: 'regular',\n      user: client.user\n    }, (parent === null || parent === void 0 ? void 0 : parent.id) ? {\n      parent_id: parent.id\n    } : null);\n  }, [client.user, client.userID]);\n  var sendMessage = useCallback(function (_a, customMessageData) {\n    var _b = _a.attachments,\n        attachments = _b === void 0 ? [] : _b,\n        _c = _a.mentioned_users,\n        mentioned_users = _c === void 0 ? [] : _c,\n        _d = _a.parent,\n        parent = _d === void 0 ? undefined : _d,\n        _e = _a.text,\n        text = _e === void 0 ? '' : _e;\n    return __awaiter(void 0, void 0, void 0, function () {\n      var messagePreview;\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            if (!channel) return [2\n            /*return*/\n            ]; // remove error messages upon submit\n\n            channel.state.filterErrorMessages();\n            messagePreview = createMessagePreview(text, attachments, parent, mentioned_users); // first we add the message to the UI\n\n            updateMessage(messagePreview);\n            return [4\n            /*yield*/\n            , doSendMessage(messagePreview, customMessageData)];\n\n          case 1:\n            _f.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [channel === null || channel === void 0 ? void 0 : channel.state, createMessagePreview, doSendMessage, updateMessage]);\n  var retrySendMessage = useCallback(function (message) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // set the message status to sending\n            updateMessage(__assign(__assign({}, message), {\n              errorStatusCode: undefined,\n              status: 'sending'\n            })); // actually try to send the message...\n\n            return [4\n            /*yield*/\n            , doSendMessage(message)];\n\n          case 1:\n            // actually try to send the message...\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [doSendMessage, updateMessage]);\n  var removeMessage = useCallback(function (message) {\n    if (!channel) return;\n    channel.state.removeMessage(message);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && message.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  }, [channel, state.thread]);\n  /** THREAD */\n\n  var openThread = useCallback(function (message, event) {\n    if (!channel) return;\n\n    if (event && event.preventDefault) {\n      event.preventDefault();\n    }\n\n    dispatch({\n      channel: channel,\n      message: message,\n      type: 'openThread'\n    });\n  }, [channel]);\n  var loadMoreThreadFinished = useCallback(debounce(function (threadHasMore, threadMessages) {\n    dispatch({\n      threadHasMore: threadHasMore,\n      threadMessages: threadMessages,\n      type: 'loadMoreThreadFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  }), []);\n  var loadMoreThread = useCallback(function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var parentID, oldMessages, oldestMessageID, limit, queryResponse, threadHasMoreMessages, newThreadMessages, e_3;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            // prevent duplicate loading events...\n            if (!channel || state.threadLoadingMore || !state.thread) return [2\n            /*return*/\n            ];\n            dispatch({\n              type: 'startLoadingThread'\n            });\n            parentID = state.thread.id;\n\n            if (!parentID) {\n              dispatch({\n                type: 'closeThread'\n              });\n              return [2\n              /*return*/\n              ];\n            }\n\n            oldMessages = channel.state.threads[parentID] || [];\n            oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n            limit = 50;\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , channel.getReplies(parentID, {\n              id_lt: oldestMessageID,\n              limit: limit\n            })];\n\n          case 2:\n            queryResponse = _b.sent();\n            threadHasMoreMessages = queryResponse.messages.length === limit;\n            newThreadMessages = channel.state.threads[parentID] || []; // next set loadingMore to false so we can start asking for more data...\n\n            loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_3 = _b.sent();\n            loadMoreThreadFinished(false, oldMessages);\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [channel, loadMoreThreadFinished, state.thread, state.threadLoadingMore]);\n  var closeThread = useCallback(function (event) {\n    if (event && event.preventDefault) {\n      event.preventDefault();\n    }\n\n    dispatch({\n      type: 'closeThread'\n    });\n  }, []);\n  var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n  var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n\n  var typing = state.typing,\n      restState = __rest(state, [\"typing\"]);\n\n  var channelStateContextValue = __assign(__assign({}, restState), {\n    acceptedFiles: acceptedFiles,\n    channel: channel,\n    channelConfig: channelConfig,\n    maxNumberOfFiles: maxNumberOfFiles,\n    multipleUploads: multipleUploads,\n    mutes: mutes,\n    notifications: notifications,\n    quotedMessage: quotedMessage,\n    watcher_count: state.watcherCount\n  });\n\n  var channelActionContextValue = {\n    addNotification: addNotification,\n    closeThread: closeThread,\n    dispatch: dispatch,\n    editMessage: editMessage,\n    loadMore: loadMore,\n    loadMoreThread: loadMoreThread,\n    onMentionsClick: onMentionsHoverOrClick,\n    onMentionsHover: onMentionsHoverOrClick,\n    openThread: openThread,\n    removeMessage: removeMessage,\n    retrySendMessage: retrySendMessage,\n    sendMessage: sendMessage,\n    setQuotedMessage: setQuotedMessage,\n    updateMessage: updateMessage\n  };\n  var componentContextValue = useMemo(function () {\n    return {\n      Attachment: props.Attachment || DefaultAttachment,\n      AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n      AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n      AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n      Avatar: props.Avatar,\n      CooldownTimer: props.CooldownTimer,\n      DateSeparator: props.DateSeparator,\n      EditMessageInput: props.EditMessageInput,\n      EmojiIcon: props.EmojiIcon,\n      EmptyStateIndicator: props.EmptyStateIndicator,\n      FileUploadIcon: props.FileUploadIcon,\n      GiphyPreviewMessage: props.GiphyPreviewMessage,\n      HeaderComponent: props.HeaderComponent,\n      Input: props.Input,\n      LoadingIndicator: props.LoadingIndicator,\n      Message: props.Message || MessageSimple,\n      MessageDeleted: props.MessageDeleted,\n      MessageListNotifications: props.MessageListNotifications,\n      MessageNotification: props.MessageNotification,\n      MessageOptions: props.MessageOptions,\n      MessageRepliesCountButton: props.MessageRepliesCountButton,\n      MessageStatus: props.MessageStatus,\n      MessageSystem: props.MessageSystem,\n      MessageTimestamp: props.MessageTimestamp,\n      PinIndicator: props.PinIndicator,\n      QuotedMessage: props.QuotedMessage,\n      QuotedMessagePreview: props.QuotedMessagePreview,\n      ReactionSelector: props.ReactionSelector,\n      ReactionsList: props.ReactionsList,\n      SendButton: props.SendButton,\n      ThreadHeader: props.ThreadHeader,\n      ThreadStart: props.ThreadStart,\n      TriggerProvider: props.TriggerProvider,\n      TypingIndicator: props.TypingIndicator,\n      VirtualMessage: props.VirtualMessage\n    };\n  }, []);\n  var emojiContextValue = useMemo(function () {\n    return {\n      Emoji: props.Emoji,\n      emojiConfig: emojiConfig,\n      EmojiIndex: props.EmojiIndex,\n      EmojiPicker: props.EmojiPicker\n    };\n  }, []);\n  var typingContextValue = {\n    typing: typing\n  };\n\n  if (state.error) {\n    return React.createElement(\"div\", {\n      className: \"str-chat str-chat-channel \" + theme\n    }, React.createElement(LoadingErrorIndicator, {\n      error: state.error\n    }));\n  }\n\n  if (state.loading) {\n    return React.createElement(\"div\", {\n      className: \"str-chat str-chat-channel \" + theme\n    }, React.createElement(LoadingIndicator, {\n      size: 25\n    }));\n  }\n\n  if (!(channel === null || channel === void 0 ? void 0 : channel.watch)) {\n    return React.createElement(\"div\", {\n      className: \"str-chat str-chat-channel \" + theme\n    }, React.createElement(\"div\", null, t('Channel Missing')));\n  }\n\n  return React.createElement(\"div\", {\n    className: \"str-chat str-chat-channel \" + theme + (useImageFlagEmojisOnWindows && navigator.platform.match(/Win/) ? ' str-chat--windows-flags' : '')\n  }, React.createElement(ChannelStateProvider, {\n    value: channelStateContextValue\n  }, React.createElement(ChannelActionProvider, {\n    value: channelActionContextValue\n  }, React.createElement(ComponentProvider, {\n    value: componentContextValue\n  }, React.createElement(EmojiProvider, {\n    value: emojiContextValue\n  }, React.createElement(TypingProvider, {\n    value: typingContextValue\n  }, React.createElement(\"div\", {\n    className: 'str-chat__container'\n  }, children)))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\n\n\nexport var Channel = React.memo(UnMemoizedChannel);","map":{"version":3,"sources":["/Users/rj/Documents/0. coding-project/medical-pager-chat/client/node_modules/stream-chat-react/dist/components/Channel/Channel.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__spreadArray","to","from","il","j","React","useCallback","useEffect","useLayoutEffect","useMemo","useReducer","useRef","useState","debounce","throttle","logChatPromiseExecution","v4","uuidv4","channelReducer","initialState","commonEmoji","defaultMinimalEmojis","emojiSetDef","useEditMessageHandler","useIsMounted","useMentionsHandlers","Attachment","DefaultAttachment","LoadingErrorIndicator","DefaultLoadingErrorIndicator","LoadingIndicator","DefaultLoadingIndicator","MessageSimple","ChannelActionProvider","ChannelStateProvider","ComponentProvider","useChatContext","EmojiProvider","useTranslationContext","TypingProvider","defaultEmojiData","UnMemoizedChannel","props","propsChannel","channel","_a","EmptyPlaceholder","contextChannel","cid","createElement","ChannelInner","key","acceptedFiles","children","doMarkReadRequest","doSendMessageRequest","doUpdateMessageRequest","emojiData","_b","_c","maxNumberOfFiles","_d","multipleUploads","onMentionsClick","onMentionsHover","_e","client","mutes","theme","useImageFlagEmojisOnWindows","_f","notifications","setNotifications","_g","quotedMessage","setQuotedMessage","notificationTimeouts","_h","state","dispatch","isMounted","originalTitle","lastRead","Date","online","channelConfig","getConfig","emojiConfig","throttledCopyStateFromChannel","type","leading","trailing","markRead","disconnected","read_events","current","document","title","markReadThrottled","handleEvent","event","message","mainChannelUpdated","parent_id","show_in_channel","user","id","userID","hidden","muteStatus","muted","unread","countUnread","errored","onVisibilityChange","e_1","initialized","watch","error","addEventListener","on","removeEventListener","off","forEach","clearTimeout","thread","messages","addNotification","text","prevNotifications","timeout","setTimeout","filter","notification","loadMoreFinished","hasMore","loadMore","limit","oldestMessage","oldestID","perPage","queryResponse","e_2","hasMoreMessages","window","navigator","onLine","loadingMore","status","query","id_lt","watchers","console","warn","updateMessage","updatedMessage","addMessageSorted","parentId","isUserResponseArray","output","doSendMessage","customMessageData","attachments","mentioned_users","mentions","messageData","messageResponse","error_1","stringError","parsedError","map","quoted_message_id","sendMessage","undefined","JSON","stringify","parse","errorStatusCode","createMessagePreview","parent","clientSideID","__html","created_at","html","reactions","messagePreview","filterErrorMessages","retrySendMessage","removeMessage","openThread","preventDefault","loadMoreThreadFinished","threadHasMore","threadMessages","loadMoreThread","parentID","oldMessages","oldestMessageID","threadHasMoreMessages","newThreadMessages","e_3","threadLoadingMore","threads","getReplies","closeThread","onMentionsHoverOrClick","editMessage","typing","restState","channelStateContextValue","watcher_count","watcherCount","channelActionContextValue","componentContextValue","AutocompleteSuggestionHeader","AutocompleteSuggestionItem","AutocompleteSuggestionList","Avatar","CooldownTimer","DateSeparator","EditMessageInput","EmojiIcon","EmptyStateIndicator","FileUploadIcon","GiphyPreviewMessage","HeaderComponent","Input","Message","MessageDeleted","MessageListNotifications","MessageNotification","MessageOptions","MessageRepliesCountButton","MessageStatus","MessageSystem","MessageTimestamp","PinIndicator","QuotedMessage","QuotedMessagePreview","ReactionSelector","ReactionsList","SendButton","ThreadHeader","ThreadStart","TriggerProvider","TypingIndicator","VirtualMessage","emojiContextValue","Emoji","EmojiIndex","EmojiPicker","typingContextValue","className","loading","size","platform","match","Channel","memo"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nimport React, { useCallback, useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState, } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution, } from 'stream-chat';\nimport { v4 as uuidv4 } from 'uuid';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator, LoadingIndicator as DefaultLoadingIndicator, } from '../Loading';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { ChannelActionProvider, } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider, } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport defaultEmojiData from '../../stream-emoji.json';\nvar UnMemoizedChannel = function (props) {\n    var propsChannel = props.channel, _a = props.EmptyPlaceholder, EmptyPlaceholder = _a === void 0 ? null : _a;\n    var contextChannel = useChatContext().channel;\n    var channel = propsChannel || contextChannel;\n    if (!(channel === null || channel === void 0 ? void 0 : channel.cid))\n        return EmptyPlaceholder;\n    return React.createElement(ChannelInner, __assign({}, props, { channel: channel, key: channel.cid }));\n};\nvar ChannelInner = function (props) {\n    var acceptedFiles = props.acceptedFiles, channel = props.channel, children = props.children, doMarkReadRequest = props.doMarkReadRequest, doSendMessageRequest = props.doSendMessageRequest, doUpdateMessageRequest = props.doUpdateMessageRequest, _a = props.emojiData, emojiData = _a === void 0 ? defaultEmojiData : _a, _b = props.LoadingErrorIndicator, LoadingErrorIndicator = _b === void 0 ? DefaultLoadingErrorIndicator : _b, _c = props.LoadingIndicator, LoadingIndicator = _c === void 0 ? DefaultLoadingIndicator : _c, maxNumberOfFiles = props.maxNumberOfFiles, _d = props.multipleUploads, multipleUploads = _d === void 0 ? true : _d, onMentionsClick = props.onMentionsClick, onMentionsHover = props.onMentionsHover;\n    var _e = useChatContext(), client = _e.client, mutes = _e.mutes, theme = _e.theme, useImageFlagEmojisOnWindows = _e.useImageFlagEmojisOnWindows;\n    var t = useTranslationContext().t;\n    var _f = useState([]), notifications = _f[0], setNotifications = _f[1];\n    var _g = useState(), quotedMessage = _g[0], setQuotedMessage = _g[1];\n    var notificationTimeouts = [];\n    var _h = useReducer(channelReducer, initialState), state = _h[0], dispatch = _h[1];\n    var isMounted = useIsMounted();\n    var originalTitle = useRef('');\n    var lastRead = useRef(new Date());\n    var online = useRef(true);\n    var channelConfig = channel.getConfig();\n    var emojiConfig = {\n        commonEmoji: commonEmoji,\n        defaultMinimalEmojis: defaultMinimalEmojis,\n        emojiData: emojiData,\n        emojiSetDef: emojiSetDef,\n    };\n    var throttledCopyStateFromChannel = useCallback(throttle(function () {\n        if (!channel)\n            return;\n        dispatch({ channel: channel, type: 'copyStateFromChannelOnEvent' });\n    }, 500, { leading: true, trailing: true }), [channel]);\n    var markRead = useCallback(function () {\n        var _a;\n        if (!channel || channel.disconnected || !((_a = channel.getConfig()) === null || _a === void 0 ? void 0 : _a.read_events)) {\n            return;\n        }\n        lastRead.current = new Date();\n        if (doMarkReadRequest) {\n            doMarkReadRequest(channel);\n        }\n        else {\n            logChatPromiseExecution(channel.markRead(), 'mark read');\n        }\n        if (originalTitle.current) {\n            document.title = originalTitle.current;\n        }\n    }, [channel, doMarkReadRequest]);\n    var markReadThrottled = useCallback(throttle(markRead, 500, { leading: true, trailing: true }), [markRead]);\n    var handleEvent = useCallback(function (event) {\n        var _a, _b, _c, _d, _e;\n        if (event.message) {\n            dispatch({\n                channel: channel,\n                message: event.message,\n                type: 'updateThreadOnEvent',\n            });\n        }\n        if (event.type === 'typing.start' || event.type === 'typing.stop') {\n            dispatch({\n                channel: channel,\n                type: 'setTyping',\n            });\n            return;\n        }\n        if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n            online.current = event.online;\n        }\n        if (event.type === 'message.new') {\n            var mainChannelUpdated = true;\n            if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n                mainChannelUpdated = false;\n            }\n            if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n                if (!document.hidden) {\n                    markReadThrottled();\n                }\n                else if (((_e = channel.getConfig()) === null || _e === void 0 ? void 0 : _e.read_events) && !channel.muteStatus().muted) {\n                    var unread = channel.countUnread(lastRead.current);\n                    document.title = \"(\" + unread + \") \" + originalTitle.current;\n                }\n            }\n        }\n        throttledCopyStateFromChannel();\n    }, [channel, client.userID, markReadThrottled, throttledCopyStateFromChannel]);\n    // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n    useLayoutEffect(function () {\n        var errored = false;\n        var done = false;\n        var onVisibilityChange = function () {\n            if (!document.hidden) {\n                markRead();\n            }\n        };\n        (function () { return __awaiter(void 0, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(channel && !channel.initialized)) return [3 /*break*/, 4];\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.watch()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        dispatch({ error: e_1, type: 'setError' });\n                        errored = true;\n                        return [3 /*break*/, 4];\n                    case 4:\n                        done = true;\n                        originalTitle.current = document.title;\n                        if (channel && !errored) {\n                            dispatch({ channel: channel, type: 'initStateFromChannel' });\n                            if (channel.countUnread() > 0)\n                                markRead();\n                            // The more complex sync logic is done in Chat\n                            document.addEventListener('visibilitychange', onVisibilityChange);\n                            client.on('connection.changed', handleEvent);\n                            client.on('connection.recovered', handleEvent);\n                            client.on('user.updated', handleEvent);\n                            client.on('user.deleted', handleEvent);\n                            channel.on(handleEvent);\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); })();\n        return function () {\n            if (errored || !done)\n                return;\n            document.removeEventListener('visibilitychange', onVisibilityChange);\n            if (channel)\n                channel.off(handleEvent);\n            client.off('connection.changed', handleEvent);\n            client.off('connection.recovered', handleEvent);\n            client.off('user.updated', handleEvent);\n            client.off('user.deleted', handleEvent);\n            notificationTimeouts.forEach(clearTimeout);\n        };\n    }, [channel, client, handleEvent, markRead]);\n    useEffect(function () {\n        var _a;\n        if (state.thread && ((_a = state.messages) === null || _a === void 0 ? void 0 : _a.length)) {\n            for (var i = state.messages.length - 1; i >= 0; i -= 1) {\n                if (state.messages[i].id === state.thread.id) {\n                    dispatch({ message: state.messages[i], type: 'setThread' });\n                    break;\n                }\n            }\n        }\n    }, [state.messages, state.thread]);\n    /** MESSAGE */\n    // Adds a temporary notification to message list, will be removed after 5 seconds\n    var addNotification = function (text, type) {\n        if (typeof text !== 'string' || (type !== 'success' && type !== 'error')) {\n            return;\n        }\n        var id = uuidv4();\n        setNotifications(function (prevNotifications) { return __spreadArray(__spreadArray([], prevNotifications), [{ id: id, text: text, type: type }]); });\n        var timeout = setTimeout(function () {\n            return setNotifications(function (prevNotifications) {\n                return prevNotifications.filter(function (notification) { return notification.id !== id; });\n            });\n        }, 5000);\n        notificationTimeouts.push(timeout);\n    };\n    var loadMoreFinished = useCallback(debounce(function (hasMore, messages) {\n        if (!isMounted.current)\n            return;\n        dispatch({ hasMore: hasMore, messages: messages, type: 'loadMoreFinished' });\n    }, 2000, {\n        leading: true,\n        trailing: true,\n    }), []);\n    var loadMore = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-inferrable-types\n    function (limit) {\n        if (limit === void 0) { limit = 100; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var oldestMessage, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!online.current || !window.navigator.onLine || !channel)\n                            return [2 /*return*/, 0];\n                        oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n                        if (state.loadingMore || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received')\n                            return [2 /*return*/, 0];\n                        // initial state loads with up to 25 messages, so if less than 25 no need for additional query\n                        if (channel.state.messages.length < 25) {\n                            loadMoreFinished(false, channel.state.messages);\n                            return [2 /*return*/, channel.state.messages.length];\n                        }\n                        dispatch({ loadingMore: true, type: 'setLoadingMore' });\n                        oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n                        perPage = limit;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.query({\n                                messages: { id_lt: oldestID, limit: perPage },\n                                watchers: { limit: perPage },\n                            })];\n                    case 2:\n                        queryResponse = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_2 = _b.sent();\n                        console.warn('message pagination request failed with error', e_2);\n                        dispatch({ loadingMore: false, type: 'setLoadingMore' });\n                        return [2 /*return*/, 0];\n                    case 4:\n                        hasMoreMessages = queryResponse.messages.length === perPage;\n                        loadMoreFinished(hasMoreMessages, channel.state.messages);\n                        return [2 /*return*/, queryResponse.messages.length];\n                }\n            });\n        });\n    }, [channel, loadMoreFinished, online, state.loadingMore, state.messages]);\n    var updateMessage = useCallback(function (updatedMessage) {\n        if (!channel)\n            return;\n        // adds the message to the local channel state..\n        // this adds to both the main channel state as well as any reply threads\n        channel.state.addMessageSorted(updatedMessage, true);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && updatedMessage.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    }, [channel, state.thread]);\n    var isUserResponseArray = function (output) { var _a; return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null; };\n    var doSendMessage = useCallback(function (message, customMessageData) { return __awaiter(void 0, void 0, void 0, function () {\n        var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, error_1, stringError, parsedError;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!channel)\n                        return [2 /*return*/];\n                    attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n                    mentions = isUserResponseArray(mentioned_users)\n                        ? mentioned_users.map(function (_a) {\n                            var id = _a.id;\n                            return id;\n                        })\n                        : mentioned_users;\n                    messageData = __assign({ attachments: attachments, id: id, mentioned_users: mentions, parent_id: parent_id, quoted_message_id: quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id, text: text }, customMessageData);\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 6, , 7]);\n                    messageResponse = void 0;\n                    if (!doSendMessageRequest) return [3 /*break*/, 3];\n                    return [4 /*yield*/, doSendMessageRequest(channel.cid, messageData)];\n                case 2:\n                    messageResponse = _b.sent();\n                    return [3 /*break*/, 5];\n                case 3: return [4 /*yield*/, channel.sendMessage(messageData)];\n                case 4:\n                    messageResponse = _b.sent();\n                    _b.label = 5;\n                case 5:\n                    // replace it after send is completed\n                    if (messageResponse && messageResponse.message) {\n                        updateMessage(__assign(__assign({}, messageResponse.message), { status: 'received' }));\n                    }\n                    if (quotedMessage)\n                        setQuotedMessage(undefined);\n                    return [3 /*break*/, 7];\n                case 6:\n                    error_1 = _b.sent();\n                    stringError = JSON.stringify(error_1);\n                    parsedError = stringError ? JSON.parse(stringError) : {};\n                    updateMessage(__assign(__assign({}, message), { errorStatusCode: parsedError.status || undefined, status: 'failed' }));\n                    return [3 /*break*/, 7];\n                case 7: return [2 /*return*/];\n            }\n        });\n    }); }, [channel, doSendMessageRequest, quotedMessage, updateMessage]);\n    var createMessagePreview = useCallback(function (text, attachments, parent, mentioned_users) {\n        // create a preview of the message\n        var clientSideID = client.userID + \"-\" + uuidv4();\n        return __assign({ __html: text, attachments: attachments, created_at: new Date(), html: text, id: clientSideID, mentioned_users: mentioned_users, reactions: [], status: 'sending', text: text, type: 'regular', user: client.user }, ((parent === null || parent === void 0 ? void 0 : parent.id) ? { parent_id: parent.id } : null));\n    }, [client.user, client.userID]);\n    var sendMessage = useCallback(function (_a, customMessageData) {\n        var _b = _a.attachments, attachments = _b === void 0 ? [] : _b, _c = _a.mentioned_users, mentioned_users = _c === void 0 ? [] : _c, _d = _a.parent, parent = _d === void 0 ? undefined : _d, _e = _a.text, text = _e === void 0 ? '' : _e;\n        return __awaiter(void 0, void 0, void 0, function () {\n            var messagePreview;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        if (!channel)\n                            return [2 /*return*/];\n                        // remove error messages upon submit\n                        channel.state.filterErrorMessages();\n                        messagePreview = createMessagePreview(text, attachments, parent, mentioned_users);\n                        // first we add the message to the UI\n                        updateMessage(messagePreview);\n                        return [4 /*yield*/, doSendMessage(messagePreview, customMessageData)];\n                    case 1:\n                        _f.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }, [channel === null || channel === void 0 ? void 0 : channel.state, createMessagePreview, doSendMessage, updateMessage]);\n    var retrySendMessage = useCallback(function (message) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    // set the message status to sending\n                    updateMessage(__assign(__assign({}, message), { errorStatusCode: undefined, status: 'sending' }));\n                    // actually try to send the message...\n                    return [4 /*yield*/, doSendMessage(message)];\n                case 1:\n                    // actually try to send the message...\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    }); }, [doSendMessage, updateMessage]);\n    var removeMessage = useCallback(function (message) {\n        if (!channel)\n            return;\n        channel.state.removeMessage(message);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && message.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    }, [channel, state.thread]);\n    /** THREAD */\n    var openThread = useCallback(function (message, event) {\n        if (!channel)\n            return;\n        if (event && event.preventDefault) {\n            event.preventDefault();\n        }\n        dispatch({ channel: channel, message: message, type: 'openThread' });\n    }, [channel]);\n    var loadMoreThreadFinished = useCallback(debounce(function (threadHasMore, threadMessages) {\n        dispatch({\n            threadHasMore: threadHasMore,\n            threadMessages: threadMessages,\n            type: 'loadMoreThreadFinished',\n        });\n    }, 2000, { leading: true, trailing: true }), []);\n    var loadMoreThread = useCallback(function () { return __awaiter(void 0, void 0, void 0, function () {\n        var parentID, oldMessages, oldestMessageID, limit, queryResponse, threadHasMoreMessages, newThreadMessages, e_3;\n        var _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    // prevent duplicate loading events...\n                    if (!channel || state.threadLoadingMore || !state.thread)\n                        return [2 /*return*/];\n                    dispatch({ type: 'startLoadingThread' });\n                    parentID = state.thread.id;\n                    if (!parentID) {\n                        dispatch({ type: 'closeThread' });\n                        return [2 /*return*/];\n                    }\n                    oldMessages = channel.state.threads[parentID] || [];\n                    oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n                    limit = 50;\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, channel.getReplies(parentID, {\n                            id_lt: oldestMessageID,\n                            limit: limit,\n                        })];\n                case 2:\n                    queryResponse = _b.sent();\n                    threadHasMoreMessages = queryResponse.messages.length === limit;\n                    newThreadMessages = channel.state.threads[parentID] || [];\n                    // next set loadingMore to false so we can start asking for more data...\n                    loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n                    return [3 /*break*/, 4];\n                case 3:\n                    e_3 = _b.sent();\n                    loadMoreThreadFinished(false, oldMessages);\n                    return [3 /*break*/, 4];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); }, [channel, loadMoreThreadFinished, state.thread, state.threadLoadingMore]);\n    var closeThread = useCallback(function (event) {\n        if (event && event.preventDefault) {\n            event.preventDefault();\n        }\n        dispatch({ type: 'closeThread' });\n    }, []);\n    var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n    var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n    var typing = state.typing, restState = __rest(state, [\"typing\"]);\n    var channelStateContextValue = __assign(__assign({}, restState), { acceptedFiles: acceptedFiles, channel: channel, channelConfig: channelConfig, maxNumberOfFiles: maxNumberOfFiles, multipleUploads: multipleUploads, mutes: mutes, notifications: notifications, quotedMessage: quotedMessage, watcher_count: state.watcherCount });\n    var channelActionContextValue = {\n        addNotification: addNotification,\n        closeThread: closeThread,\n        dispatch: dispatch,\n        editMessage: editMessage,\n        loadMore: loadMore,\n        loadMoreThread: loadMoreThread,\n        onMentionsClick: onMentionsHoverOrClick,\n        onMentionsHover: onMentionsHoverOrClick,\n        openThread: openThread,\n        removeMessage: removeMessage,\n        retrySendMessage: retrySendMessage,\n        sendMessage: sendMessage,\n        setQuotedMessage: setQuotedMessage,\n        updateMessage: updateMessage,\n    };\n    var componentContextValue = useMemo(function () { return ({\n        Attachment: props.Attachment || DefaultAttachment,\n        AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n        AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n        AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n        Avatar: props.Avatar,\n        CooldownTimer: props.CooldownTimer,\n        DateSeparator: props.DateSeparator,\n        EditMessageInput: props.EditMessageInput,\n        EmojiIcon: props.EmojiIcon,\n        EmptyStateIndicator: props.EmptyStateIndicator,\n        FileUploadIcon: props.FileUploadIcon,\n        GiphyPreviewMessage: props.GiphyPreviewMessage,\n        HeaderComponent: props.HeaderComponent,\n        Input: props.Input,\n        LoadingIndicator: props.LoadingIndicator,\n        Message: props.Message || MessageSimple,\n        MessageDeleted: props.MessageDeleted,\n        MessageListNotifications: props.MessageListNotifications,\n        MessageNotification: props.MessageNotification,\n        MessageOptions: props.MessageOptions,\n        MessageRepliesCountButton: props.MessageRepliesCountButton,\n        MessageStatus: props.MessageStatus,\n        MessageSystem: props.MessageSystem,\n        MessageTimestamp: props.MessageTimestamp,\n        PinIndicator: props.PinIndicator,\n        QuotedMessage: props.QuotedMessage,\n        QuotedMessagePreview: props.QuotedMessagePreview,\n        ReactionSelector: props.ReactionSelector,\n        ReactionsList: props.ReactionsList,\n        SendButton: props.SendButton,\n        ThreadHeader: props.ThreadHeader,\n        ThreadStart: props.ThreadStart,\n        TriggerProvider: props.TriggerProvider,\n        TypingIndicator: props.TypingIndicator,\n        VirtualMessage: props.VirtualMessage,\n    }); }, []);\n    var emojiContextValue = useMemo(function () { return ({\n        Emoji: props.Emoji,\n        emojiConfig: emojiConfig,\n        EmojiIndex: props.EmojiIndex,\n        EmojiPicker: props.EmojiPicker,\n    }); }, []);\n    var typingContextValue = {\n        typing: typing,\n    };\n    if (state.error) {\n        return (React.createElement(\"div\", { className: \"str-chat str-chat-channel \" + theme },\n            React.createElement(LoadingErrorIndicator, { error: state.error })));\n    }\n    if (state.loading) {\n        return (React.createElement(\"div\", { className: \"str-chat str-chat-channel \" + theme },\n            React.createElement(LoadingIndicator, { size: 25 })));\n    }\n    if (!(channel === null || channel === void 0 ? void 0 : channel.watch)) {\n        return (React.createElement(\"div\", { className: \"str-chat str-chat-channel \" + theme },\n            React.createElement(\"div\", null, t('Channel Missing'))));\n    }\n    return (React.createElement(\"div\", { className: \"str-chat str-chat-channel \" + theme + (useImageFlagEmojisOnWindows && navigator.platform.match(/Win/)\n            ? ' str-chat--windows-flags'\n            : '') },\n        React.createElement(ChannelStateProvider, { value: channelStateContextValue },\n            React.createElement(ChannelActionProvider, { value: channelActionContextValue },\n                React.createElement(ComponentProvider, { value: componentContextValue },\n                    React.createElement(EmojiProvider, { value: emojiContextValue },\n                        React.createElement(TypingProvider, { value: typingContextValue },\n                            React.createElement(\"div\", { className: 'str-chat__container' }, children))))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\nexport var Channel = React.memo(UnMemoizedChannel);\n"]},"metadata":{},"sourceType":"module"}